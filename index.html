<!DOCTYPE html>
<html lang="en">
  <head>
    <!--
      This is the page head - it contains info the browser uses to display the page
      You won't see what's in the head in the page
      Scroll down to the body element for the page content
    -->

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="https://glitch.com/favicon.ico" />

    <!-- 
      This is an HTML comment
      You can write text in a comment and the content won't be visible in the page
    -->

    <title>REDCap Event Armer</title>

    <meta
      name="description"
      content="A simple way to set up REDCap Events and arms"
    />
    <meta name="robots" content="index,follow" />
    <meta property="og:title" content="Hello World!" />
    <meta
      property="og:description"
      content="A simple way to set up REDCap Events and arms"
    />
    <!-- Import the webpage's stylesheet -->
    <link rel="stylesheet" href="/style.css" />

    <!-- Import the webpage's javascript file -->
    <script src="/script.js" type="module"></script>
  </head>
  <body>
    <div class="wrapper"
         data-controller="armcopy-sync"
         data-armcopy-sync-param-value="as">
      <h2 contenteditable
          data-controller="urlsync placeholder"
          data-action="input->urlsync#update focus->placeholder#focus blur->placeholder#blur input->placeholder#update"
          data-urlsync-param-name-value="proj"
          data-placeholder-text-value="Project name (click to edit)">
      </h2>
      <div class="armtable"
           data-controller="grid-copier"
           data-gridUrlSyncArmParamValue="asel">
        <div id = "armbuttons"></div>
        <table id="mapping_table"
               data-controller="grid-url-sync"
               data-grid-url-sync-arm-param-value="asel"
               data-action="initialize->grid-url-sync#setChecksFromURL">
        </table>
        <button
                data-action="grid-copier#copy"
                data-grid-copier-target="button">
          Copy selections to
        </button>
        <select id="arm_copy"
                data-grid-copier-target="select"
                data-action="grid-copier#setButtonActive"
                data-armcopy-sync-target="select"></select>          
      </div>
      <div class="inputs">
        <div class="arm_input">
          <label for="arm_list">
            Arms
          </label>
          <textarea id="arm_list"
                    name="as"
                    data-controller="urlsync arm-updater tablizer"
                    data-action="urlsync#update arm-updater#update tablizer#build_table armcopy-sync#update"
                    data-armcopy-sync-target="textarea"
                    data-param="arms"
                    data-radiocontainer="armbuttons"
                    data-tableid="mapping_table"
                    placeholder="one per line"
                    ></textarea>
        </div>
        <div class="event_input">
          <label for="event_list">
            Events
          </label>
          <textarea id="event_list"
                    name="es"
                    data-controller="urlsync tablizer"
                    data-action="urlsync#update tablizer#build_table"
                    data-tableid="mapping_table"
                    placeholder="one per line"
                    ></textarea>
        </div>

        <div class="instrument_input">
          <label for="instrument_list">
            Instruments
          </label>
          <textarea
                    id="instrument_list"
                    name="is"
                    data-controller="urlsync tablizer"
                    data-action="urlsync#update tablizer#build_table"
                    data-tableid="mapping_table"
                    placeholder="one per line"
                    ></textarea>
        </div>
        <div id="outputs" data-controller="output" data-action="update->output#update">
          <div class="events_output">
            <a id="events_download" download="events.csv" href="#">CSV for <strong>Define My Events</strong></a>
          </div>
          <div class="mapping_output">
            <a id="mapping_download" download="events.csv" href="#">CSV for <strong>Designate Instruments for My Events</strong></a>
          </div>        
        </div>      
      </div>
      <section class="description">
        <h3>
          What is this?
        </h3>
        <p>
          In REDCap, you may want to collect data from different instruments from participants in different arms of your study. For example, you might want to only collect information on how easy it is to stick with the intervention from your intervention group. A promising way to do this is to use REDCap's Arms feature in the Longitudinal Design module; however, using study arms requires that participants are assigned to an arm when enrolling in the study — so collecting some data before randomization doesn't work. Yes, this seems dumb to me. REDCap is weird sometimes.
        </p>
        <p>
          A workaround is to use Events to simulate Arms. You can do this by hand, but if you have more than a handful of arms, events, and instruments, the interface gets very complicated very fast, and it's hard to really see what's going on. And that leads to bugs.
        </p>
        <p>
          The goal of this project is to give an easier interface to use this hack. Copy a list of instrument names (you can get this from your Data Dictionary), name your arms, and list your events — each one per-line. Check the boxes for which instruments you want at each event in each arm, and then use the links to download CSV files for uploading to REDCap's <strong>Define My Events</strong> and <strong>Designate Instruments for My Events</strong> pages.
        </p>
        <p>
          In this project, all data is stored in the URL. To save a configuration, bookmark it. You can send a link to someone and have them see what you're seeing, as well.
        </p>
      </section>
    </div>
  </body>
</html>
